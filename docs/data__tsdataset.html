---

title: MASK example and test


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/data__tsdataset.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/data__tsdataset.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TimeSeriesDataset" class="doc_header"><code>class</code> <code>TimeSeriesDataset</code><a href="https://github.com/Grupo-Abraxas/nixtla/tree/master/nixtla/data/tsdataset.py#L21" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TimeSeriesDataset</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwds</code></strong>) :: <code>Dataset</code></p>
</blockquote>
<p>An abstract class representing a :class:<code>Dataset</code>.</p>
<p>All datasets that represent a map from keys to data samples should subclass
it. All subclasses should overwrite :meth:<code>__getitem__</code>, supporting fetching a
data sample for a given key. Subclasses could also optionally overwrite
:meth:<code>__len__</code>, which is expected to return the size of the dataset by many
:class:<code>~torch.utils.data.Sampler</code> implementations and the default options
of :class:<code>~torch.utils.data.DataLoader</code>.</p>
<p>.. note::
  :class:<code>~torch.utils.data.DataLoader</code> by default constructs a index
  sampler that yields integral indices.  To make it work with a map-style
  dataset with non-integral indices/keys, a custom sampler must be provided.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_mask_df" class="doc_header"><code>get_mask_df</code><a href="https://github.com/Grupo-Abraxas/nixtla/tree/master/nixtla/data/tsdataset.py#L220" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_mask_df</code>(<strong><code>Y_df</code></strong>, <strong><code>n_timestamps</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">nixtla.data.datasets.epf</span> <span class="kn">import</span> <span class="n">EPF</span><span class="p">,</span> <span class="n">EPFInfo</span>

<span class="n">val_ds</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">365</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="s1">&#39;dataset&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;NP&#39;</span><span class="p">]})</span>

<span class="n">Y_df</span><span class="p">,</span> <span class="n">Xt_df</span><span class="p">,</span> <span class="n">S_df</span> <span class="o">=</span> <span class="n">EPF</span><span class="o">.</span><span class="n">load_groups</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="s1">&#39;../data&#39;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">dataset</span><span class="p">)</span>

<span class="n">mask_df</span> <span class="o">=</span> <span class="n">get_mask_df</span><span class="p">(</span><span class="n">Y_df</span><span class="o">=</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">n_timestamps</span><span class="o">=</span><span class="n">val_ds</span><span class="o">*</span><span class="mi">24</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mask_df</span><span class="o">.</span><span class="n">sample_mask</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&lt;matplotlib.lines.Line2D at 0x7f904d754b10&gt;]</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="n">TimeSeriesDataset</span><span class="p">(</span><span class="n">Y_df</span><span class="o">=</span><span class="n">Y_df</span><span class="p">,</span> <span class="n">S_df</span><span class="o">=</span><span class="n">S_df</span><span class="p">,</span> <span class="n">X_df</span><span class="o">=</span><span class="n">Xt_df</span><span class="p">,</span> <span class="n">mask_df</span><span class="o">=</span><span class="n">mask_df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/home/federicogarza2/anaconda3/envs/nixtla/lib/python3.7/site-packages/ipykernel_launcher.py:119: DeprecationWarning: np.asscalar(a) is deprecated since NumPy v1.16, use a.item() instead
/home/federicogarza2/anaconda3/envs/nixtla/lib/python3.7/site-packages/ipykernel_launcher.py:120: DeprecationWarning: np.asscalar(a) is deprecated since NumPy v1.16, use a.item() instead
/home/federicogarza2/anaconda3/envs/nixtla/lib/python3.7/site-packages/ipykernel_launcher.py:169: DeprecationWarning: setting an array element with a sequence. This was supported in some cases where the elements are arrays with a single element. For example `np.array([1, np.array([2])], dtype=int)`. In the future this will raise the same ValueError as `np.array([1, [2]], dtype=int)`.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">t_cols</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;y&#39;,
 &#39;Exogenous1&#39;,
 &#39;Exogenous2&#39;,
 &#39;week_day&#39;,
 &#39;day_0&#39;,
 &#39;day_1&#39;,
 &#39;day_2&#39;,
 &#39;day_3&#39;,
 &#39;day_4&#39;,
 &#39;day_5&#39;,
 &#39;day_6&#39;,
 &#39;available_mask&#39;,
 &#39;sample_mask&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">ts_tensor</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">t_cols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">),</span> <span class="p">:])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[31.05 30.47 28.92 ... 49.09 49.02 48.1 ]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dataset.ts_tensor.shape&quot;</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">ts_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>dataset.ts_tensor.shape (1, 13, 52416)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">filtered</span><span class="p">,</span> <span class="n">right_padding</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">get_filtered_ts_tensor</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">output_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">window_sampling_limit</span><span class="o">=</span><span class="mi">36</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

