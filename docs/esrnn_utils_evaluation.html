---

title: ESRNN utils losses


keywords: fastai
sidebar: home_sidebar

summary: "API details."
description: "API details."
nb_path: "nbs/esrnn_utils_evaluation.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/esrnn_utils_evaluation.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="detrend" class="doc_header"><code>detrend</code><a href="https://github.com/Grupo-Abraxas/nixtla/tree/master/nixtla/models/esrnn/utils/evaluation.py#L15" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>detrend</code>(<strong><code>insample_data</code></strong>)</p>
</blockquote>
<p>Calculates a &amp; b parameters of LRL
:param insample_data:
:return:</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="deseasonalize" class="doc_header"><code>deseasonalize</code><a href="https://github.com/Grupo-Abraxas/nixtla/tree/master/nixtla/models/esrnn/utils/evaluation.py#L25" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>deseasonalize</code>(<strong><code>original_ts</code></strong>, <strong><code>ppy</code></strong>)</p>
</blockquote>
<p>Calculates and returns seasonal indices
:param original_ts: original data
:param ppy: periods per year
:return:</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="moving_averages" class="doc_header"><code>moving_averages</code><a href="https://github.com/Grupo-Abraxas/nixtla/tree/master/nixtla/models/esrnn/utils/evaluation.py#L52" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>moving_averages</code>(<strong><code>ts_init</code></strong>, <strong><code>window</code></strong>)</p>
</blockquote>
<p>Calculates the moving averages for a given TS
:param ts_init: the original time series
:param window: window length
:return: moving averages ts</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="seasonality_test" class="doc_header"><code>seasonality_test</code><a href="https://github.com/Grupo-Abraxas/nixtla/tree/master/nixtla/models/esrnn/utils/evaluation.py#L81" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>seasonality_test</code>(<strong><code>original_ts</code></strong>, <strong><code>ppy</code></strong>)</p>
</blockquote>
<p>Seasonality test
:param original_ts: time series
:param ppy: periods per year
:return: boolean value: whether the TS is seasonal</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="acf" class="doc_header"><code>acf</code><a href="https://github.com/Grupo-Abraxas/nixtla/tree/master/nixtla/models/esrnn/utils/evaluation.py#L96" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>acf</code>(<strong><code>data</code></strong>, <strong><code>k</code></strong>)</p>
</blockquote>
<p>Autocorrelation function
:param data: time series
:param k: lag
:return:</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Naive" class="doc_header"><code>class</code> <code>Naive</code><a href="https://github.com/Grupo-Abraxas/nixtla/tree/master/nixtla/models/esrnn/utils/evaluation.py#L114" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Naive</code>()</p>
</blockquote>
<p>Naive model.
This benchmark model produces a forecast that is equal to
the last observed value for a given time series.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="SeasonalNaive" class="doc_header"><code>class</code> <code>SeasonalNaive</code><a href="https://github.com/Grupo-Abraxas/nixtla/tree/master/nixtla/models/esrnn/utils/evaluation.py#L134" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>SeasonalNaive</code>()</p>
</blockquote>
<p>Seasonal Naive model.
This benchmark model produces a forecast that is equal to
the last observed value of the same season for a given time
series.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Naive2" class="doc_header"><code>class</code> <code>Naive2</code><a href="https://github.com/Grupo-Abraxas/nixtla/tree/master/nixtla/models/esrnn/utils/evaluation.py#L158" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Naive2</code>(<strong><code>seasonality</code></strong>)</p>
</blockquote>
<p>Naive2 model.
Popular benchmark model for time series forecasting that automatically adapts
to the potential seasonality of a series based on an autocorrelation test.
If the series is seasonal the model composes the predictions of Naive and SeasonalNaive,
else the model predicts on the simple Naive.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="mse" class="doc_header"><code>mse</code><a href="https://github.com/Grupo-Abraxas/nixtla/tree/master/nixtla/models/esrnn/utils/evaluation.py#L190" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>mse</code>(<strong><code>y</code></strong>, <strong><code>y_hat</code></strong>)</p>
</blockquote>
<p>Calculates Mean Squared Error.</p>
<h2 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h2><p>y: numpy array
    actual test values
y_hat: numpy array
    predicted values</p>
<h2 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h2><p>mse: float
    mean squared error</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="mape" class="doc_header"><code>mape</code><a href="https://github.com/Grupo-Abraxas/nixtla/tree/master/nixtla/models/esrnn/utils/evaluation.py#L211" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>mape</code>(<strong><code>y</code></strong>, <strong><code>y_hat</code></strong>)</p>
</blockquote>
<p>Calculates Mean Absolute Percentage Error.</p>
<h2 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h2><p>y: numpy array
    actual test values
y_hat: numpy array
    predicted values</p>
<h2 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h2><p>mape: float
    mean absolute percentage error</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="smape" class="doc_header"><code>smape</code><a href="https://github.com/Grupo-Abraxas/nixtla/tree/master/nixtla/models/esrnn/utils/evaluation.py#L232" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>smape</code>(<strong><code>y</code></strong>, <strong><code>y_hat</code></strong>)</p>
</blockquote>
<p>Calculates Symmetric Mean Absolute Percentage Error.</p>
<h2 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h2><p>y: numpy array
    actual test values
y_hat: numpy array
    predicted values</p>
<h2 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h2><p>smape: float
    symmetric mean absolute percentage error</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="mase" class="doc_header"><code>mase</code><a href="https://github.com/Grupo-Abraxas/nixtla/tree/master/nixtla/models/esrnn/utils/evaluation.py#L253" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>mase</code>(<strong><code>y</code></strong>, <strong><code>y_hat</code></strong>, <strong><code>y_train</code></strong>, <strong><code>seasonality</code></strong>)</p>
</blockquote>
<p>Calculates Mean Absolute Scaled Error.</p>
<h2 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h2><p>y: numpy array
    actual test values
y_hat: numpy array
    predicted values
y_train: numpy array
    actual train values for Naive1 predictions
seasonality: int
    main frequency of the time series
    Quarterly 4, Daily 7, Monthly 12</p>
<h2 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h2><p>mase: float
    mean absolute scaled error</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="evaluate_panel" class="doc_header"><code>evaluate_panel</code><a href="https://github.com/Grupo-Abraxas/nixtla/tree/master/nixtla/models/esrnn/utils/evaluation.py#L286" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>evaluate_panel</code>(<strong><code>y_panel</code></strong>, <strong><code>y_hat_panel</code></strong>, <strong><code>metric</code></strong>, <strong><code>y_insample</code></strong>=<em><code>None</code></em>, <strong><code>seasonality</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Calculates metric for y_panel and y_hat_panel
y_panel: pandas df
    panel with columns unique_id, ds, y
y_naive2_panel: pandas df
    panel with columns unique_id, ds, y_hat
y_insample: pandas df
    panel with columns unique_id, ds, y (train)
    this is used in the MASE
seasonality: int
    main frequency of the time series
    Quarterly 4, Daily 7, Monthly 12
return: list of metric evaluations</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="owa" class="doc_header"><code>owa</code><a href="https://github.com/Grupo-Abraxas/nixtla/tree/master/nixtla/models/esrnn/utils/evaluation.py#L334" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>owa</code>(<strong><code>y_panel</code></strong>, <strong><code>y_hat_panel</code></strong>, <strong><code>y_naive2_panel</code></strong>, <strong><code>y_insample</code></strong>, <strong><code>seasonality</code></strong>)</p>
</blockquote>
<p>Calculates MASE, sMAPE for Naive2 and current model
then calculatess Overall Weighted Average.
y_panel: pandas df
    panel with columns unique_id, ds, y
y_hat_panel: pandas df
    panel with columns unique_id, ds, y_hat
y_naive2_panel: pandas df
    panel with columns unique_id, ds, y_hat
y_insample: pandas df
    panel with columns unique_id, ds, y (train)
    this is used in the MASE
seasonality: int
    main frequency of the time series
    Quarterly 4, Daily 7, Monthly 12
return: OWA</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="evaluate_prediction_owa" class="doc_header"><code>evaluate_prediction_owa</code><a href="https://github.com/Grupo-Abraxas/nixtla/tree/master/nixtla/models/esrnn/utils/evaluation.py#L372" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>evaluate_prediction_owa</code>(<strong><code>y_hat_df</code></strong>, <strong><code>y_train_df</code></strong>, <strong><code>X_test_df</code></strong>, <strong><code>y_test_df</code></strong>, <strong><code>naive2_seasonality</code></strong>)</p>
</blockquote>
<p>y_hat_df: pandas df
    panel with columns unique_id, ds, y_hat
y_train_df: pandas df
    panel with columns unique_id, ds, y
X_test_df: pandas df
    panel with columns unique_id, ds, x
y_test_df: pandas df
    panel with columns unique_id, ds, y, y_hat_naive2
naive2_seasonality: int
    seasonality for the Naive2 predictions (needed for owa)
model: python class
    python class with predict method</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

