# AUTOGENERATED! DO NOT EDIT! File to edit: nbs/data_datasets__buisness.ipynb (unless otherwise specified).

__all__ = ['D1', 'D2', 'BusinessInfo', 'Business']

# Cell
import os
from dataclasses import dataclass
from pathlib import Path
from typing import Dict, List, Optional, Tuple, Union

import numpy as np
import pandas as pd
import s3fs
from dotenv import load_dotenv

from .utils import download_file, Info, TimeSeriesDataclass
from ..tsdataset import TimeSeriesDataset

# Cell
load_dotenv()

# Cell
@dataclass
class D1:
    seasonality: int = 7
    horizon: int = 7

@dataclass
class D2:
    seasonality: int = 7
    horizon: int = 7

# Cell
BusinessInfo = Info(groups=('D1', 'D2'),
                    class_groups=(D1, D2))

# Cell
class Business(TimeSeriesDataclass):

    @staticmethod
    def load(directory: str,
             group: str,
             return_tensor: bool = True): #-> Union[TimeSeriesDataset, TimeSeriesDataclass]:
        """
        Downloads and loads Tourism data.

        Parameters
        ----------
        directory: str
            Directory where data will be downloaded.
        group: str
            Group name.
            Allowed groups: 'D1', 'D2'.
        return_tensor: bool
            Wheter return TimeSeriesDataset (tensors, True) or
            TimeSeriesDataclass (dataframes)

        Notes
        -----
        [1] Returns train+test sets.
        """
        path = Path(directory) / 'business' / 'datasets'

        Business.download(directory)

        df = pd.read_csv(path / f'ts-{group.lower()}.csv')

        #if return_tensor:
        #    return TimeSeriesDataset(y_df=df, X_s_df=None, X_t_df=None, output_size=class_group.horizon)
        #else:
        #    return TimeSeriesDataclass(Y=df, S=None, X=None, group=group)
        return df, None

    @staticmethod
    def download(directory: str) -> None:
        """Downloads Business Dataset."""

        fs = s3fs.S3FileSystem(key=os.environ['AWS_ACCES_KEY_ID'],
                               secret=os.environ['AWS_SECRET_ACCESS_KEY'])

        path = Path(directory) / 'business' / 'datasets'
        if not path.exists():
            file = 's3://research-storage-orax/business-data/ts-d{number}.csv'
            for i in [1, 2]:
                download_file = path / f'ts-d{i}.csv'
                fs.download(file.format(number=i), str(download_file))